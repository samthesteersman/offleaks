---
title: "Little analysis"
output: pdf_document
---

This project for Social and Economic Networks course uses Offshore Leaks Database found here <https://offshoreleaks.icij.org/>.

```{r, echo = FALSE}
# loading files
addresses <- read.csv(file = 'offshore_leaks_csvs-20160513/Addresses.csv')
edges <- read.csv(file = 'offshore_leaks_csvs-20160513/all_edges.csv')
entities <- read.csv(file = 'offshore_leaks_csvs-20160513/Entities.csv')
inters <- read.csv(file = 'offshore_leaks_csvs-20160513/Intermediaries.csv')
officers <- read.csv(file = 'offshore_leaks_csvs-20160513/Officers.csv')
```

```{r, include = FALSE}
# loading libraries
library(dplyr)
library(ggplot2)
```

## Yearly counts development

One would like to know how many accounts have been opened throughout years.

```{r, echo = FALSE}
# looking at available dates of the accounts creation
ent <- entities
ent$incorporation_date <- as.Date(x = as.character(ent$incorporation_date), format = "%d-%b-%Y")
ent <- ent[!is.na(ent$incorporation_date),]
ent$incorporation_year <- as.numeric(format(ent$incorporation_date, "%Y"))
```

The sample size for answering this question is `r nrow(ent)`.

The earliest opened account belongs to `r min(ent$incorporation_year)` and the latest comes from the future `r max(ent$incorporation_year)`.

The most fruitful years for the offshore accounts are the following:

```{r, echo = FALSE}
head(arrange(count(ent, incorporation_year), desc(n)))
```

Overall, that is how the process looks like:

```{r, echo = FALSE}
ggplot(data = ent) + geom_bar(aes(x = incorporation_year)) + theme_bw()
```

## Nodes decomposed

The main connections file provides `r nrow(edges)` links/edges. At both ends one can find different players.

### Origin nodes

There are `r length(unique(edges$node_1))` unique origin nodes/vertices.

```{r, echo = FALSE}
n1e <- sum(unique(edges$node_1) %in% entities$node_id)
# from all the links, 93572 entities connect to something
n1a <- sum(unique(edges$node_1) %in% addresses$node_id)
# 960
n1i <- sum(unique(edges$node_1) %in% inters$node_id)
# 23600
n1o <- sum(unique(edges$node_1) %in% officers$node_id)
# 345475
n1 <- n1e + n1a + n1i + n1o
```

They are distributed among the types in the following manner: 

Entities        |Addresses        |Intermediaries   |Officers         
----------------|-----------------|-----------------|-----------------
`r n1e`         |`r n1a`          |`r n1i`          |`r n1o`          
`r 100*n1e/n1`% |`r 100*n1a/n1`%  |`r 100*n1i/n1`%  |`r 100*n1o/n1`%  

A note. The decomposition does not sum up to the number of unique entries. `r n1` = `r length(unique(edges$node_1))` is `r n1 == length(unique(edges$node_1))`.

### Receiving nodes

Looking at the unique receiving nodes/vertices, one can find that there are `r length(unique(edges$node_2))` of them.

```{r, echo = FALSE}
n2e <- sum(unique(edges$node_2) %in% entities$node_id)
# from all the links, there 319122 connections to entities 
n2a <- sum(unique(edges$node_2) %in% addresses$node_id)
# 151043
n2i <- sum(unique(edges$node_2) %in% inters$node_id)
# 355
n2o <- sum(unique(edges$node_2) %in% officers$node_id)
# 21664
n2 <- n2e + n2a + n2i + n2o
```

They are distributed among the types in the following manner: 

Entities        |Addresses        |Intermediaries   |Officers         
----------------|-----------------|-----------------|-----------------
`r n2e`         |`r n2a`          |`r n2i`          |`r n2o`          
`r 100*n2e/n2`% |`r 100*n2a/n2`%  |`r 100*n2i/n2`%  |`r 100*n2o/n2`%  

In the same manner `r n2` = `r length(unique(edges$node_2))` is `r n2 == length(unique(edges$node_2))`.